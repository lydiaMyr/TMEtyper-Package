exp=read.table("C:/Users/10767/Desktop/example_data.txt",header=T,sep="\t",row.names=1)
library(GSVA)
library(Biobase)

# 假设您有一个表达矩阵 exp_matrix
# 行是基因，列是样本
# exp_matrix <- your_expression_data

# 定义 T 细胞耗竭基因集
exhaustion_genes <- list(
  Tcell_Exhaustion = c("PDCD1", "CTLA4", "LAG3", "TIM3", "TIGIT", 
                       "HAVCR2", "BTLA", "CD244", "ENTPD1", "CD160")
)

# 方法1: 使用 ssgseaParam (GSVA >= 1.38.0)
# 方法2: 传统语法
exhaustion_scores <- gsva(as.matrix(exp), 
                          exhaustion_genes,
                          method = "ssgsea")         # 显示进度

# 查看结果
print(head(exhaustion_scores))



library(GSVA)

# 检查版本并选择相应方法
gsva_version <- packageVersion("GSVA")

if (exists("ssgseaParam", where = asNamespace("GSVA"))) {
  # 新版本：使用 ssgseaParam
  param <- ssgseaParam(as.matrix(exp), exhaustion_genes)
  scores <- gsva(param)
  
} else {
  # 旧版本：直接参数传递
  scores <- gsva(as.matrix(exp), exhaustion_genes, method = "ssgsea")
  
}

file_path <- system.file("extdata", "example_data.txt", package = "TMEtyper")

TMEtyper(file_path,"rnaseq")

# 创建正确的目录
if (!dir.exists("inst/extdata")) {
  dir.create("inst/extdata", recursive = TRUE)
}

# 将文件从 data/ 移动到 inst/extdata/
file.copy("data/example_data.txt", "inst/extdata/example_data.txt", overwrite = TRUE)

# 验证移动成功
print(paste("文件现在在 inst/extdata/:", file.exists("inst/extdata/example_data.txt")))
print(paste("文件还在 data/:", file.exists("data/example_data.txt")))


# 清理
devtools::clean_dll()

# 重新生成文档
devtools::document()

# 构建包
devtools::build()

# 安装
devtools::install(force = TRUE)

# 测试
library(TMEtyper)
file_path <- system.file("extdata", "example_data.txt", package = "TMEtyper")
print(paste("文件路径:", file_path))
print(paste("文件存在:", file.exists(file_path)))